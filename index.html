<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-63QEF6ST40"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-63QEF6ST40');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>알랑가 | 관계 회복 솔루션</title>
    
    <!-- Open Graph / SNS 공유용 메타 태그 -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="알랑가 | 관계 회복 솔루션">
    <meta property="og:description" content="싸운 다음 날, 가장 확실한 화해 공식. 당신의 진심을 완벽하게 세팅해 드립니다.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1591950669299-4444558e8055?q=80&w=1000&auto=format&fit=crop">

    <!-- 폰트: Pretendard -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-cream': '#F9F8F4',
                        'text-dark': '#111111',
                        'deep-green': '#1A3C34',
                        'alert-red': '#D32F2F',
                        'gold-accent': '#C4A484',
                    },
                    fontFamily: {
                        sans: ['Pretendard', '-apple-system', 'sans-serif'],
                    },
                    boxShadow: {
                        'floating': '0 20px 40px -10px rgba(26, 60, 52, 0.15)',
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #F9F8F4;
            color: #111111;
            font-family: 'Pretendard', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden-section { display: none; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); }
            100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); }
        }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1A3C34;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased pb-20">

    <!-- Sticky Timer Bar -->
    <div class="fixed top-0 w-full bg-deep-green text-white z-50 py-3 text-center text-xs font-medium tracking-wide shadow-md">
        <span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-2 pulse"></span>
        금일 서울/경기 긴급 배송 마감까지 : <span id="timer" class="font-bold text-red-400 text-sm ml-1">02:14:59</span>
    </div>

    <main class="max-w-md mx-auto min-h-screen pt-16 px-5 relative">
        
        <!-- Hero Section -->
        <section id="hero-section" class="pt-8 mb-12 text-center">
            <div class="inline-block px-3 py-1 bg-deep-green/10 text-deep-green text-[11px] font-bold rounded-full mb-6 fade-in-up">
                회복 성공률 98% | 누적 4,200건
            </div>
            <h1 class="text-3xl font-extrabold leading-[1.3] text-deep-green mb-4 fade-in-up delay-100">
                싸운 다음 날,<br>가장 확실한 화해 공식
            </h1>
            <p class="text-text-dark/60 text-sm font-medium leading-relaxed mb-10 fade-in-up delay-200">
                어설픈 사과는 오히려 독이 됩니다.<br>
                당신의 진심을 완벽하게 세팅해 드립니다.
            </p>
            
            <div class="bg-white p-6 rounded-2xl shadow-floating border border-deep-green/5 text-left relative overflow-hidden fade-in-up delay-300">
                <div class="absolute top-0 right-0 bg-alert-red text-white text-[10px] font-bold px-3 py-1 rounded-bl-xl">긴급 솔루션</div>
                <h3 class="text-lg font-bold text-deep-green mb-6">현재 상황을 선택하세요</h3>
                
                <div class="flex border-b border-gray-100 mb-6">
                    <button onclick="switchTab('sorry')" id="tab-sorry" class="flex-1 py-3 text-sm font-bold border-b-2 border-deep-green text-deep-green transition-all">미안한 마음</button>
                    <button onclick="switchTab('celebrate')" id="tab-celebrate" class="flex-1 py-3 text-sm font-bold border-b-2 border-transparent text-gray-400 transition-all">축하와 응원</button>
                </div>

                <div id="situation-container" class="grid grid-cols-1 gap-3 transition-opacity duration-300">
                    <!-- 상황 버튼들이 여기에 렌더링됩니다 -->
                </div>
            </div>
        </section>

        <!-- Interactive Steps Section -->
        <section id="solution-section" class="hidden-section pb-20">
            <div class="flex justify-center mb-8">
                <span id="selected-situation-badge" class="px-4 py-2 bg-deep-green text-white text-xs font-bold rounded-full shadow-md"></span>
            </div>

            <!-- [Step 2: 사연 입력] -->
            <div id="sub-step-1" class="transition-opacity duration-500">
                <button onclick="goBackToHero()" class="mb-6 text-xs text-gray-400 hover:text-deep-green transition-colors flex items-center">
                    ← 상황 다시 선택하기
                </button>

                <div class="mb-12">
                    <div class="mb-8">
                        <label class="block text-[11px] font-bold text-deep-green mb-2 ml-1 opacity-70">상대방을 부르는 호칭 (선택)</label>
                        <input id="user-nickname" type="text" 
                            class="w-full p-4 rounded-xl border border-gray-200 bg-white focus:outline-none focus:border-deep-green focus:ring-1 focus:ring-deep-green text-sm shadow-sm transition-all" 
                            placeholder="예: 자기야, 지은아, 우리 여보">
                    </div>

                    <h3 id="story-title" class="text-xl font-bold text-deep-green mb-3"></h3>
                    <p class="text-xs text-gray-500 mb-4">구체적으로 적을수록 AI 코치가 더 완벽한 편지를 작성합니다.</p>
                    <textarea id="user-story" class="w-full h-40 p-5 rounded-2xl border border-gray-300 bg-white focus:outline-none focus:border-deep-green focus:ring-1 focus:ring-deep-green resize-none text-sm leading-relaxed shadow-inner"></textarea>
                </div>
                
                <button onclick="nextSubStep()" class="w-full py-5 bg-deep-green text-white rounded-2xl text-lg font-bold shadow-xl hover:bg-[#15302a] transition-all transform active:scale-95">
                    입력 완료하고 맞춤 꽃 확인하기
                </button>
            </div>

            <!-- [Step 3: AI 통역 결과 + 추천 스타일] -->
            <div id="sub-step-2" class="hidden opacity-0 transition-opacity duration-500">
                <div class="mb-16">
                    <h3 class="text-lg font-bold text-deep-green mb-6 text-center">AI 코치가 당신의 마음을 이렇게 통역했습니다</h3>
                    <div class="bg-[#FDFBF7] p-8 rounded-2xl shadow-inner border border-stone-200 relative mb-12">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-stone-200 text-stone-600 px-3 py-1 text-[10px] uppercase tracking-widest font-bold rounded-sm">Message Preview</div>
                        <div id="ai-preview-content" class="text-gray-700 leading-loose text-sm font-serif whitespace-pre-wrap pt-4"></div>
                        <div class="mt-6 text-right text-xs text-gray-400 font-serif">- 당신의 진심을 담아</div>
                    </div>

                    <!-- 플로리스트 추천 스타일 (대형 이미지 레이아웃) -->
                    <div class="mb-12">
                        <h3 class="text-lg font-bold text-deep-green mb-6 text-center">이 진심과 가장 잘 어울리는 플로리스트의 제안</h3>
                        <div class="relative w-full aspect-[16/10] mb-6 overflow-hidden rounded-2xl shadow-floating border border-white/20">
                            <img id="recommend-flower-img" src="" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105 bg-gray-100" alt="플로리스트 추천 꽃">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                            <div class="flex items-center space-x-3 mb-3">
                                <div id="recommend-color-chip" class="w-5 h-5 rounded-full border border-gray-100 shadow-sm"></div>
                                <span class="text-[11px] font-bold text-deep-green opacity-80 uppercase tracking-widest">Florist's Color Tone</span>
                            </div>
                            <p id="recommend-text" class="text-sm text-gray-600 leading-relaxed font-medium"></p>
                        </div>
                    </div>
                </div>

                <button onclick="goToStep4()" class="w-full py-5 bg-deep-green text-white rounded-2xl text-lg font-bold shadow-xl hover:bg-[#15302a] transition-all transform active:scale-95">
                    어울리는 꽃 선택하러 가기
                </button>
                
                <button onclick="prevSubStep()" class="w-full mt-6 text-xs text-gray-400 font-medium hover:text-deep-green transition-colors">
                    ← 사연 수정하기 (이전으로)
                </button>
            </div>

            <!-- [Step 4: 꽃 패키지 선택 및 결제] -->
            <div id="sub-step-3" class="hidden opacity-0 transition-opacity duration-500">
                <button onclick="goBackToStep3()" class="mb-6 text-xs text-gray-400 hover:text-deep-green transition-colors flex items-center">
                    ← 편지 다시 보기
                </button>

                <h3 class="text-xl font-bold text-deep-green mb-8 text-center">어떤 패키지로 진심을 전할까요?</h3>
                
                <div class="grid grid-cols-1 gap-4 mb-12">
                    <div id="opt-premium" onclick="selectPackage('premium')" class="p-6 bg-white rounded-2xl border-2 shadow-floating cursor-pointer transition-all border-transparent">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="text-[10px] font-bold text-gold-accent bg-gold-accent/10 px-2 py-0.5 rounded-full uppercase">Signature</span>
                                <h4 class="text-lg font-bold text-deep-green mt-1">프리미엄 시그니처 다발</h4>
                            </div>
                            <div class="text-xl font-extrabold text-deep-green">59,000원</div>
                        </div>
                        <p class="text-xs text-gray-500 leading-relaxed">추천 컬러를 반영한 풍성한 계절 꽃과 프리미엄 기프트 박스가 포함됩니다.</p>
                    </div>
                    
                    <div id="opt-simple" onclick="selectPackage('simple')" class="p-6 bg-white rounded-2xl border-2 shadow-floating cursor-pointer transition-all border-transparent">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full uppercase">Simple</span>
                                <h4 class="text-lg font-bold text-deep-green mt-1">에센셜 심플 패키지</h4>
                            </div>
                            <div class="text-xl font-extrabold text-deep-green">45,000원</div>
                        </div>
                        <p class="text-xs text-gray-500 leading-relaxed">깔끔하고 세련된 단일 품종 중심의 꽃다발로 확실하게 진심을 전합니다.</p>
                    </div>
                </div>

                <button id="pay-btn" onclick="processPayment()" class="w-full py-5 bg-deep-green text-white rounded-2xl text-lg font-bold shadow-xl hover:bg-[#15302a] transition-all transform active:scale-95">
                    <span id="pay-btn-text">선택한 패키지로 결제하기</span>
                </button>

                <div class="mt-4 flex items-center justify-center space-x-1.5 text-deep-green font-semibold text-[10px] text-center px-4">
                    <span>🛡️</span>
                    <span>안심하세요. 수령인에게는 결제 금액이 절대 노출되지 않으며, 안전한 익명 배송이 가능합니다.</span>
                </div>
            </div>
        </section>

        <!-- Success Section -->
        <section id="result-section" class="hidden-section pb-20">
            <div class="text-center mb-10">
                <div class="inline-block p-3 bg-green-100 rounded-full text-deep-green mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-deep-green mb-2">접수 완료되었습니다</h2>
                <p class="text-sm text-gray-500">당신의 진심이 안전하게 배송 예약되었습니다.<br>정성껏 준비하여 전달하겠습니다.</p>
            </div>
            <div class="bg-white p-8 rounded-xl border border-gray-100 shadow-sm text-center mb-8">
                <p class="text-xs text-gray-500 mb-2">예상 배송 도착</p>
                <p id="delivery-day" class="text-lg font-bold text-deep-green"></p>
            </div>
            <button onclick="location.reload()" class="w-full py-4 bg-gray-200 text-gray-600 rounded-xl text-sm font-bold hover:bg-gray-300 transition-all">처음으로 돌아가기</button>
        </section>
    </main>

    <script>
        const SITUATION_DATA = {
            sorry: [
                { id: 1, icon: "😡", text: "어제 크게 싸웠어요", ph: "예: 어제 내가 내 생각만 하고 말실수해서 정말 미안해. 많이 상처받았지? 앞으로는 한 번 더 생각하고 말할게." },
                { id: 2, icon: "📅", text: "기념일/약속을 망쳤어요", ph: "예: 우리 소중한 기념일인데 내 부주의로 망쳐버려서 면목이 없어. 네가 기대 많이 했을 텐데... 정말 미안해." },
                { id: 3, icon: "🥀", text: "요즘 너무 소홀했어요", ph: "예: 일 바쁘다는 핑계로 요즘 너를 너무 외롭게 했네. 당연한 건 없는데 내가 참 부족했어. 다시 너에게 집중할게." },
                { id: 4, icon: "💔", text: "헤어질 위기입니다", ph: "예: 우리가 쌓아온 시간들이 이렇게 끝날까 봐 너무 두려워. 내 잘못들 다 고칠게. 제발 한 번만 더 기회를 줘." }
            ],
            celebrate: [
                { id: 11, icon: "🎉", text: "완벽한 생일 축하", ph: "예: 30번째 생일 진심으로 축하해! 요즘 프로젝트 때문에 바빠서 잘 못 챙겨줬는데, 오늘만큼은 세상에서 제일 행복하게 해줄게." },
                { id: 12, icon: "👏", text: "승진 및 새로운 출발", ph: "예: 드디어 네 노력이 결실을 맺었구나! 옆에서 고생하는 거 봐왔기에 누구보다 기쁘다. 새로운 시작을 응원해." },
                { id: 13, icon: "✨", text: "특별한 기념일 (100일/1주년)", ph: "예: 벌써 우리가 함께한 지 1년이라니 꿈만 같아. 철없는 나를 항상 믿고 응원해 줘서 너무 고맙고 사랑해." },
                { id: 14, icon: "💪", text: "수고한 오늘 곁에서", ph: "예: 오늘 하루도 정말 고생 많았어. 지치고 힘들었을 텐데 묵묵히 견뎌낸 네가 너무 대견하고 고마워. 푹 쉬자." }
            ]
        };

        const POEM_DB = [
            { id: 1, type: 'sorry', author: '한용운', title: '사랑하는 까닭', quote: '내가 당신을 사랑하는 것은 까닭이 없는 것이 아닙니다. 다른 사람보다 당신을 더 사랑하는 까닭입니다.', flower: '보라색 히아신스', color: '#9B51E0', colorName: '신비로운 퍼플' },
            { id: 2, type: 'sorry', author: '김소월', title: '먼 후일', quote: '먼 후일 당신이 찾으시면 그때에 내 말이 "잊었노라". 당신이 속으로 나무라면 "무척 그리다가 잊었노라".', flower: '리시안셔스', color: '#FF85A2', colorName: '부드러운 핑크' },
            { id: 3, type: 'sorry', author: '윤동주', title: '사랑의 전당', quote: '순아, 너는 내 전당에 언제 들어왔던 것이냐. 내 마음의 문은 언제나 열려 있었노라.', flower: '흰색 안개꽃', color: '#E0E0E0', colorName: '순수한 화이트' },
            { id: 4, type: 'sorry', author: '정지용', title: '호수', quote: '보고 싶은 마음 호수만 하니 눈 감을 수밖에. 그리운 마음 하늘만 하니 눈 감을 수밖에.', flower: '푸른 장미', color: '#2D9CDB', colorName: '깊은 블루' },
            { id: 5, type: 'sorry', author: '백석', title: '나와 나타샤와 흰 당나귀', quote: '가난한 내가 아름다운 나타샤를 사랑해서 오늘 밤은 푹푹 눈이 나린다.', flower: '목화', color: '#F9F8F4', colorName: '따뜻한 크림' },
            { id: 6, type: 'sorry', author: '이육사', title: '꽃', quote: '내 마음의 꽃은 어느 산 비탈에 피었는가. 님 생각에 젖어 향기가 그윽하네.', flower: '수국', color: '#BB6BD9', colorName: '은은한 라벤더' },
            { id: 7, type: 'sorry', author: '한용운', title: '님의 침묵', quote: '사랑도 사람의 일이라, 만날 때에 미리 떠날 것을 염려하고 경계하지 아니한 것은 아니지만...', flower: '칼라', color: '#F2F2F2', colorName: '우아한 화이트' },
            { id: 8, type: 'sorry', author: '김소월', title: '진달래꽃', quote: '나 보기가 역겨워 가실 때에는 말없이 고이 보내 드리우리다.', flower: '진달래', color: '#EB5757', colorName: '진한 핑크' },
            { id: 9, type: 'sorry', author: '이상', title: '거울', quote: '내 말을 못 알아듣는 딱한 귀가 두 개나 있소. 거울 속의 내가 나를 위로하오.', flower: '델피니움', color: '#56CCF2', colorName: '맑은 스카이' },
            { id: 10, type: 'sorry', author: '정지용', title: '유리창', quote: '밤에 홀로 유리를 닦는 것은 외로운 황홀한 심사이어니.', flower: '스타치스', color: '#8E44AD', colorName: '영원한 보라' },
            { id: 11, type: 'sorry', author: '윤동주', title: '서시', quote: '별을 노래하는 마음으로 모든 죽어가는 것을 사랑해야지. 그리고 나한테 주어진 길을 걸어가야겠다.', flower: '은방울꽃', color: '#FFFFFF', colorName: '순결한 화이트' },
            { id: 12, type: 'sorry', author: '한용운', title: '복종', quote: '남들은 자유를 사랑한다지마는 나는 복종을 좋아하여요. 당신의 복종은 사랑보다도 더 달콤합니다.', flower: '카네이션', color: '#FF4D6D', colorName: '진심의 레드' },
            { id: 13, type: 'sorry', author: '김소월', title: '예전엔 미처 몰랐어요', quote: '봄바람이 불더니 이제야 알았어요. 예전엔 미처 몰랐어요. 당신이 이토록 소중한 줄.', flower: '프리지아', color: '#F2994A', colorName: '활기찬 오렌지' },
            { id: 14, type: 'sorry', author: '백석', title: '남신의주 유동 박시봉방', quote: '나는 내 슬픔과 어리석음 위에 눌리어 죽을 수밖에 없는 것을 느꼈다.', flower: '튤립', color: '#6FCF97', colorName: '싱그러운 그린' },
            { id: 15, type: 'sorry', author: '이육사', title: '청포도', quote: '내가 바라는 손님은 고달픈 몸으로 청포를 입고 찾아온다고 했으니.', flower: '유칼립투스', color: '#27AE60', colorName: '차분한 그린' },
            { id: 16, type: 'celebrate', author: '한용운', title: '사랑의 존재', quote: '사랑은 당신과 나 사이의 황금의 태양입니다. 당신은 나의 생명의 빛입니다.', flower: '해바라기', color: '#F2C94C', colorName: '찬란한 골드' },
            { id: 17, type: 'celebrate', author: '정지용', title: '향수', quote: '그곳이 참하 꿈엔들 잊힐 리야. 당신과 함께한 시간들이 보석처럼 빛납니다.', flower: '금어초', color: '#EB5757', colorName: '화사한 핑크' },
            { id: 18, type: 'celebrate', author: '윤동주', title: '별 헤는 밤', quote: '별 하나에 추억과 별 하나에 사랑과 별 하나에 쓸쓸함과 별 하나에 동경과...', flower: '스타티스', color: '#BB6BD9', colorName: '영원한 퍼플' },
            { id: 19, type: 'celebrate', author: '김소월', title: '가는 길', quote: '그립다 말을 할까 하니 그리워. 그냥 갈까 그래도 다시 더 한번...', flower: '스위트피', color: '#FADCFE', colorName: '달콤한 핑크' },
            { id: 20, type: 'celebrate', author: '백석', title: '흰 바람벽이 있어', quote: '내 가슴속에는 내 사랑하는 사람이 있다. 내 사랑하는 사람의 아름다운 이름이 있다.', flower: '작약', color: '#FF85A2', colorName: '우아한 코랄' },
            { id: 21, type: 'celebrate', author: '이육사', title: '광야', quote: '다시 천고의 뒤에 백마 타고 오는 초인이 있어 이 광야에서 목놓아 부르게 하리라.', flower: '글로리오사', color: '#D32F2F', colorName: '정열의 레드' },
            { id: 22, type: 'celebrate', author: '정지용', title: '비', quote: '유리알 같은 물방울들이 튀어 오른다. 당신의 미소가 내 가슴에 튄다.', flower: '거베라', color: '#F2994A', colorName: '맑은 오렌지' },
            { id: 23, type: 'celebrate', author: '윤동주', title: '길', quote: '내가 사는 것은 다만 잃은 것을 찾는 까닭입니다. 당신이 나의 가장 소중한 발견입니다.', flower: '라넌큘러스', color: '#FADCFE', colorName: '사랑스러운 핑크' },
            { id: 24, type: 'celebrate', author: '한용운', title: '찬송', quote: '당신의 얼굴은 봄 달과 같아서 내 마음의 어둠을 비추어 줍니다.', flower: '메리골드', color: '#F2C94C', colorName: '기쁨의 옐로우' },
            { id: 25, type: 'celebrate', author: '김소월', title: '산유화', quote: '산에는 꽃 피네 꽃이 피네. 갈 봄 여름 없이 꽃이 피네.', flower: '아네모네', color: '#9B51E0', colorName: '매혹적인 퍼플' },
            { id: 26, type: 'celebrate', author: '백석', title: '바다', quote: '아, 바다는 어쩌면 이렇게 푸른가. 당신과 함께라면 어디든 바다일 텐데.', flower: '옥시페탈룸', color: '#56CCF2', colorName: '시원한 블루' },
            { id: 27, type: 'celebrate', author: '정지용', title: '바다', quote: '바다는 뿔을 불며 달려온다. 당신을 향한 나의 마음도 이와 같다.', flower: '아마릴리스', color: '#FF4D6D', colorName: '강렬한 레드' },
            { id: 28, type: 'celebrate', author: '윤동주', title: '내일은 없다', quote: '오늘을 사랑하는 마음으로 내일을 꿈꾸노라. 당신과 함께할 내일을 축복하노라.', flower: '알스트로메리아', color: '#FF85A2', colorName: '기대 섞인 핑크' },
            { id: 29, type: 'celebrate', author: '한용운', title: '나의 꿈', quote: '당신은 나의 꿈입니다. 당신이 깨어날 때 비로소 나의 세상도 밝아옵니다.', flower: '장미', color: '#EB5757', colorName: '클래식 레드' },
            { id: 30, type: 'celebrate', author: '김소월', title: '초혼', quote: '부르다가 내가 죽을 이름이여! 심중에 남아 있는 말 한마디는 끝끝내 마저 하지 못하였구나.', flower: '리시안셔스', color: '#F2F2F2', colorName: '우아한 화이트' }
        ];

        /* [수정 위치: 꽃 이미지 데이터베이스 교체] */
        const FLOWER_IMG_DB = [
            { name: "리시안셔스", imageUrl: "https://images.unsplash.com/photo-1562690868-60bbe7293e94?auto=format&fit=crop&q=80&w=1000" },
            { name: "프리지아", imageUrl: "https://images.unsplash.com/photo-1582794543139-8ac9cb0f7b11?auto=format&fit=crop&q=80&w=1000" },
            { name: "작약", imageUrl: "https://images.unsplash.com/photo-1563241527-3004b7be0ffd?auto=format&fit=crop&q=80&w=1000" },
            { name: "델피니움", imageUrl: "https://images.unsplash.com/photo-1561181286-d3fee7d55364?auto=format&fit=crop&q=80&w=1000" }
        ];
        const DEFAULT_FLOWER_IMG = "https://images.unsplash.com/photo-1591950669299-4444558e8055?auto=format&fit=crop&q=80&w=1000";

        let currentTab = 'sorry';
        let selectedSituationText = "";
        let currentPoemData = null;
        let selectedPkg = 'premium';

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('tab-sorry').className = `flex-1 py-3 text-sm font-bold border-b-2 ${tab === 'sorry' ? 'border-deep-green text-deep-green' : 'border-transparent text-gray-400'}`;
            document.getElementById('tab-celebrate').className = `flex-1 py-3 text-sm font-bold border-b-2 ${tab === 'celebrate' ? 'border-deep-green text-deep-green' : 'border-transparent text-gray-400'}`;
            const heroTitle = document.querySelector('#hero-section h1');
            const heroSub = document.querySelector('#hero-section p');
            if (tab === 'sorry') {
                heroTitle.innerHTML = '싸운 다음 날,<br>가장 확실한 화해 공식';
                heroSub.innerText = '어설픈 사과는 오히려 독이 됩니다. 당신의 진심을 완벽하게 세팅해 드립니다.';
            } else {
                heroTitle.innerHTML = '가장 완벽한 타이밍,<br>당신의 진심을 오차 없이 번역합니다';
                heroSub.innerText = '어설픈 축하 대신, 오래 기억될 감동을 세팅해 드립니다.';
            }
            renderSituations();
        }

        function renderSituations() {
            const container = document.getElementById('situation-container');
            container.innerHTML = SITUATION_DATA[currentTab].map(sit => `
                <button onclick="selectSituation('${sit.text}', '${sit.ph}')" class="w-full py-4 px-5 rounded-xl border border-gray-200 bg-gray-50 text-left hover:border-deep-green hover:bg-deep-green/5 transition-all flex justify-between items-center group">
                    <span class="font-bold text-sm text-gray-700 group-hover:text-deep-green">${sit.icon} ${sit.text}</span>
                    <span class="text-gray-300 group-hover:text-deep-green">➜</span>
                </button>
            `).join('');
        }

        function selectSituation(text, placeholder) {
            selectedSituationText = text;
            document.getElementById('selected-situation-badge').innerText = `상황: ${text}`;
            const textarea = document.getElementById('user-story');
            textarea.placeholder = placeholder;
            if (currentTab === 'celebrate') {
                document.getElementById('story-title').innerText = "어떤 점을 가장 축하해주고 싶나요?";
            } else {
                document.getElementById('story-title').innerText = "어떤 점이 가장 미안한가요?";
            }
            document.getElementById('sub-step-1').classList.remove('hidden', 'opacity-0');
            document.getElementById('sub-step-2').classList.add('hidden', 'opacity-0');
            document.getElementById('sub-step-3').classList.add('hidden', 'opacity-0');
            document.getElementById('hero-section').classList.add('hidden');
            document.getElementById('solution-section').classList.remove('hidden-section');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextSubStep() {
            const story = document.getElementById('user-story').value;
            if (!story.trim()) { alert("사연을 적어주세요."); return; }
            const filtered = POEM_DB.filter(p => p.type === currentTab);
            currentPoemData = filtered[Math.floor(Math.random() * filtered.length)];
            document.getElementById('ai-preview-content').innerText = createLetter(story, currentPoemData);
            
            /* [수정 위치: 철벽 방어 매칭 로직 적용] */
            const flowerMatch = FLOWER_IMG_DB.find(f => currentPoemData.flower.includes(f.name));
            const finalImgUrl = flowerMatch?.imageUrl || DEFAULT_FLOWER_IMG;
            
            const imgEl = document.getElementById('recommend-flower-img');
            imgEl.src = finalImgUrl;
            imgEl.alt = `${currentPoemData.flower} 추천 이미지`;
            
            document.getElementById('recommend-color-chip').style.backgroundColor = currentPoemData.color;
            document.getElementById('recommend-text').innerHTML = `이 진심을 담기에는 <b>[${currentPoemData.colorName}]</b> 톤의 <b>[${currentPoemData.flower}]</b>가 가장 잘 어울립니다.`;
            transition('sub-step-1', 'sub-step-2');
        }

        function goToStep4() {
            let typeWord = currentTab === 'celebrate' ? (selectedSituationText.includes("축하") ? "축하" : "응원") : "화해";
            document.getElementById('pay-btn-text').innerText = `이 패키지로 ${typeWord} 마음 전달하기 (결제)`;
            transition('sub-step-2', 'sub-step-3');
            selectPackage('premium');
        }

        function transition(fromId, toId) {
            const from = document.getElementById(fromId);
            const to = document.getElementById(toId);
            from.classList.add('opacity-0');
            setTimeout(() => {
                from.classList.add('hidden');
                to.classList.remove('hidden');
                setTimeout(() => to.classList.remove('opacity-0'), 50);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 500);
        }

        function selectPackage(pkg) {
            selectedPkg = pkg;
            document.getElementById('opt-premium').className = `p-6 bg-white rounded-2xl border-2 shadow-floating cursor-pointer transition-all ${pkg==='premium'?'border-deep-green':'border-transparent'}`;
            document.getElementById('opt-simple').className = `p-6 bg-white rounded-2xl border-2 shadow-floating cursor-pointer transition-all ${pkg==='simple'?'border-deep-green':'border-transparent'}`;
        }

        function goBackToHero() { document.getElementById('solution-section').classList.add('hidden-section'); document.getElementById('hero-section').classList.remove('hidden'); }
        function prevSubStep() { transition('sub-step-2', 'sub-step-1'); }
        function goBackToStep3() { transition('sub-step-3', 'sub-step-2'); }

        function createLetter(userStory, p) {
            const nickname = document.getElementById('user-nickname').value.trim() || "그대";
            const story = userStory.trim();
            const opening = `${nickname},`;
            const intros = p.type === 'sorry' 
                ? [`사실 마음 한구석이 며칠째 무겁기만 했어. 너에게 닿지 못한 내 서툰 진심이 공중에 흩어지는 것 같아서, 떨리는 마음으로 이 글을 적어봐.`, `미안하다는 말 한마디를 내뱉기가 왜 이리도 어려웠을까. 내 이기심에 가려 보지 못했던 너의 상처를 이제야 마주하며 깊이 반성하고 있어.`]
                : [`오늘처럼 찬란한 날, 너와 함께할 수 있다는 건 내 인생에서 가장 큰 축복이야.`, `세상이 온통 너를 위해 축복을 노래하는 것 같은 날이야. 진심을 다해 축하의 마음을 전하고 싶어.`];
            const intro = intros[Math.floor(Math.random() * intros.length)];
            const formattedStory = story.endsWith('.') || story.endsWith('!') || story.endsWith('?') ? story : story + '.';

            return `${opening}\n\n${intro}\n\n${formattedStory}\n\n${p.author} 시인은 <${p.title}>에서 이렇게 노래했지. \n'${p.quote}'\n\n이 시구처럼, 내 곁에 있는 '너'라는 존재가 얼마나 소중하고 귀한지 다시 한번 깊이 깨달았어. 마음을 가득 담아 '${p.flower}'를 함께 보내.\n\n이 꽃의 향기가 내 서툰 표현들을 대신해 네 마음에 깊이 머물기를 바라. 앞으로는 더 많이 아끼고, 더 세심하게 너의 곁을 지킬게. 고맙고 사랑해.`;
        }

        function processPayment() {
            const btn = document.getElementById('pay-btn');
            btn.disabled = true;
            btn.innerHTML = `<span class="loader mr-2"></span> 결제 승인 중...`;
            setTimeout(() => {
                document.getElementById('solution-section').classList.add('hidden-section');
                document.getElementById('result-section').classList.remove('hidden-section');
                const days = ['일','월','화','수','목','금','토'];
                const tom = new Date(); tom.setDate(new Date().getDate()+1);
                document.getElementById('delivery-day').innerText = `내일 (${days[tom.getDay()]}) 오후 2시 ~ 4시`;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 2000);
        }

        function startTimer() {
            let duration = 3600 * 2 + 14 * 60 + 59;
            setInterval(() => {
                let h = Math.floor(duration/3600), m = Math.floor((duration%3600)/60), s = duration%60;
                document.getElementById('timer').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                if (duration > 0) duration--;
            }, 1000);
        }

        window.onload = () => { startTimer(); renderSituations(); };
    </script>
</body>
</html>
