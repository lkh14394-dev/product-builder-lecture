<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œë‘ê°€ (Alangga) - ë§ˆìŒ ë²ˆì—­ & ê½ƒ ì¶”ì²œ</title>
    <style>
        :root {
            --primary: #ff8fa3;
            --primary-light: #fff0f3;
            --secondary: #ffb3c1;
            --accent: #fb6f92;
            --text: #4a4a4a;
            --bg: #fffcfc;
            --card-bg: #ffffff;
            --border: #ffe5ec;
            --shadow: 0 4px 12px rgba(255, 143, 163, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        header h1 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1rem;
        }

        .section-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        select, input[type="text"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #fff;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .btn-container {
            text-align: center;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(251, 111, 146, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 111, 146, 0.4);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #666;
            margin-top: 10px;
        }

        /* Result Section */
        #result-section {
            display: none;
        }

        .flower-sets {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 600px) {
            .flower-sets {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        .flower-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--border);
            position: relative;
        }

        .flower-card h3 {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 1.1rem;
        }

        .palette {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .color-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .flower-list {
            margin-bottom: 15px;
        }

        .flower-item {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .flower-reasoning {
            font-size: 0.85rem;
            color: #666;
            background: var(--primary-light);
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .letter-card {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .letter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .letter-type {
            font-weight: bold;
            color: var(--accent);
        }

        .copy-btn {
            background: none;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: var(--primary);
            color: white;
        }

        .letter-body {
            white-space: pre-wrap;
            font-size: 0.95rem;
            color: #444;
        }

        .short-phrase {
            background: #fdf2f4;
            padding: 10px 15px;
            border-radius: 10px;
            font-style: italic;
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .caution {
            font-size: 0.8rem;
            color: #d63031;
            margin-top: 8px;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ì•Œë‘ê°€ (Alangga)</h1>
        <p>ê½ƒìœ¼ë¡œ ì „í•˜ëŠ” ë‹¹ì‹ ì˜ ì§„ì‹¬, ë§ˆìŒ ë²ˆì—­ê¸°</p>
    </header>

    <div id="input-section" class="section-card">
        <h2>ğŸ’Œ í¸ì§€ ì‘ì„±í•˜ê¸°</h2>
        <div class="form-group">
            <label>ëˆ„êµ¬ì—ê²Œ ì „í•˜ì‹œë‚˜ìš”?</label>
            <select id="recipient">
                <option value="ì—°ì¸">ì—°ì¸</option>
                <option value="ê°€ì¡±">ê°€ì¡±</option>
                <option value="ì¹œêµ¬">ì¹œêµ¬</option>
                <option value="ë™ë£Œ">ë™ë£Œ</option>
                <option value="ê±°ë˜ì²˜">ê±°ë˜ì²˜</option>
                <option value="ì„ ìƒë‹˜">ì„ ìƒë‹˜</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
        </div>

        <div class="form-group">
            <label>ì–´ë–¤ ëª©ì ì¸ê°€ìš”?</label>
            <select id="purpose">
                <option value="ì‚¬ê³¼">ì‚¬ê³¼ (Apology)</option>
                <option value="ê°ì‚¬">ê°ì‚¬ (Gratitude)</option>
                <option value="ì¶•í•˜">ì¶•í•˜ (Celebration)</option>
                <option value="ìœ„ë¡œ">ìœ„ë¡œ (Comfort)</option>
                <option value="ê³ ë°±">ê³ ë°± (Love)</option>
                <option value="ì‘ì›">ì‘ì› (Support)</option>
                <option value="ì´ë³„">ì´ë³„ (Farewell)</option>
                <option value="ì¬íšŒ">ì¬íšŒ (Reunion)</option>
                <option value="ë¶€íƒ">ë¶€íƒ (Request)</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
        </div>

        <div class="form-group">
            <label>ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì • (ì¤‘ë³µ ì„ íƒ)</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ë¯¸ì•ˆí•¨"> ë¯¸ì•ˆí•¨</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ê³ ë§ˆì›€"> ê³ ë§ˆì›€</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ê·¸ë¦¬ì›€"> ê·¸ë¦¬ì›€</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ì„¤ë ˜"> ì„¤ë ˜</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ì¡´ì¤‘"> ì¡´ì¤‘</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ì•„ì‰¬ì›€"> ì•„ì‰¬ì›€</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ë”°ëœ»í•¨"> ë”°ëœ»í•¨</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ì‘ì›"> ì‘ì›</label>
                <label class="checkbox-item"><input type="checkbox" name="emotion" value="ê²°ì‹¬"> ê²°ì‹¬</label>
            </div>
        </div>

        <div class="form-group">
            <label>ì›í•˜ëŠ” ë§íˆ¬</label>
            <div class="radio-group">
                <label class="radio-item"><input type="radio" name="tone" value="ë‹´ë°±" checked> ë‹´ë°±í•˜ê²Œ</label>
                <label class="radio-item"><input type="radio" name="tone" value="ë”°ëœ»"> ë”°ëœ»í•˜ê²Œ</label>
                <label class="radio-item"><input type="radio" name="tone" value="ê²©ì‹"> ê²©ì‹ìˆê²Œ</label>
                <label class="radio-item"><input type="radio" name="tone" value="ë¬¸í•™ì "> ë¬¸í•™ì ìœ¼ë¡œ</label>
            </div>
        </div>

        <div class="form-group">
            <label>ë¶„ëŸ‰</label>
            <div class="radio-group">
                <label class="radio-item"><input type="radio" name="length" value="ì§§ê²Œ"> ì§§ê²Œ</label>
                <label class="radio-item"><input type="radio" name="length" value="ë³´í†µ" checked> ë³´í†µ</label>
                <label class="radio-item"><input type="radio" name="length" value="ê¸¸ê²Œ"> ê¸¸ê²Œ</label>
            </div>
        </div>

        <div class="form-group">
            <label>ê¼­ í¬í•¨í•  ë¬¸ì¥ (ì„ íƒ)</label>
            <input type="text" id="must-include" placeholder="ì˜ˆ: ìš°ë¦¬ ê·¸ë•Œ ì°¸ ì¢‹ì•˜ëŠ”ë°, ë°¥ í•œ ë²ˆ ë¨¹ì">
        </div>

        <div class="form-group">
            <label>í”¼í•˜ê³  ì‹¶ì€ í‘œí˜„ (ì„ íƒ)</label>
            <input type="text" id="avoid-express" placeholder="ì˜ˆ: ë¯¸ì•ˆí•˜ë‹¤ëŠ” ë§, ë„ˆë¬´ ì˜¤ê¸€ê±°ë¦¬ëŠ” í‘œí˜„">
        </div>

        <div class="form-group">
            <label>í¸ì§€ ì´ˆì•ˆ (í•„ìˆ˜)</label>
            <textarea id="draft" rows="5" placeholder="ì „í•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”. ì €í¬ê°€ ì˜ˆì˜ê²Œ ë‹¤ë“¬ì–´ ë“œë¦´ê²Œìš”."></textarea>
        </div>

        <div class="btn-container">
            <button id="generate-btn" class="btn btn-primary">ì¶”ì²œ/ë¦¬ë¼ì´íŒ… ìƒì„±</button>
        </div>
    </div>

    <div id="result-section">
        <div class="section-card">
            <h2>ğŸŒ¸ ì´ ë§ˆìŒì„ ë‹®ì€ ê½ƒ ì¡°í•©</h2>
            <div id="flower-results" class="flower-sets">
                <!-- ê½ƒ ì¶”ì²œ ì¹´ë“œê°€ ì—¬ê¸°ì— ì‚½ì…ë¨ -->
            </div>
        </div>

        <div class="section-card">
            <h2>âœï¸ ë‹¹ì‹ ì„ ìœ„í•œ ì„¸ ê°€ì§€ ë¬¸ì¥</h2>
            <div id="letter-results">
                <!-- ë¦¬ë¼ì´íŒ… ê²°ê³¼ê°€ ì—¬ê¸°ì— ì‚½ì…ë¨ -->
            </div>
        </div>

        <div class="section-card">
            <h2>âœ¨ ì§§ì€ í•œ ì¤„ ë¬¸êµ¬</h2>
            <div id="phrase-results">
                <!-- ì§§ì€ ë¬¸êµ¬ê°€ ì—¬ê¸°ì— ì‚½ì…ë¨ -->
            </div>
        </div>

        <div class="btn-container">
            <button id="reset-btn" class="btn btn-secondary">ìƒˆë¡œ ì‘ì„±í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    const FLOWER_DATA = [
        { name: "ì¥ë¯¸", colors: ["#e63946", "#ffb3c1", "#ffffff"], hex: ["#e63946", "#ffb3c1", "#ffffff"], meanings: ["ì‚¬ë‘", "í–‰ë³µ", "ì¡´ê²½"], tags: ["ê³ ë°±", "ê°ì‚¬", "ì¡´ì¤‘", "ì¶•í•˜"], caution: "ê°€ì‹œê°€ ìˆìœ¼ë‹ˆ ë‹¤ë£° ë•Œ ì£¼ì˜í•˜ì„¸ìš”." },
        { name: "íŠ¤ë¦½", colors: ["#d00000", "#ffb703", "#7b2cbf"], hex: ["#d00000", "#ffb703", "#7b2cbf"], meanings: ["ì‚¬ë‘ì˜ ê³ ë°±", "í¬ë§", "ì˜ì›í•œ ì• ì •"], tags: ["ê³ ë°±", "ì‘ì›", "ê°ì‚¬", "ì¶•í•˜"], caution: "ì˜¨ë„ì— ë¯¼ê°í•´ ê¸ˆë°© í”¼ì–´ë‚  ìˆ˜ ìˆì–´ìš”." },
        { name: "ì¹´ë„¤ì´ì…˜", colors: ["#ff4d6d", "#c9184a", "#ffffff"], hex: ["#ff4d6d", "#c9184a", "#ffffff"], meanings: ["ê°ì‚¬", "ëª¨ì •", "ì¡´ê²½"], tags: ["ê°ì‚¬", "ì¡´ì¤‘", "ê°€ì¡±"], caution: "ìŠµê¸°ì— ì•½í•˜ë‹ˆ ë¬¼ì´ ìì— ë‹¿ì§€ ì•Šê²Œ í•´ì£¼ì„¸ìš”." },
        { name: "ê±°ë² ë¼", colors: ["#ff70a6", "#ff9770", "#ffd670"], hex: ["#ff70a6", "#ff9770", "#ffd670"], meanings: ["ì‹ ë¹„", "ìˆ˜ìˆ˜ê»˜ë¼", "í¬ë§"], tags: ["ì¶•í•˜", "ì‘ì›", "ê°ì‚¬"], caution: "ì¤„ê¸°ê°€ ì˜ ë¶€ëŸ¬ì§ˆ ìˆ˜ ìˆì–´ ê³ ì •ì´ í•„ìš”í•´ìš”." },
        { name: "ì•ˆê°œê½ƒ", colors: ["#ffffff", "#ffc8dd"], hex: ["#ffffff", "#ffc8dd"], meanings: ["ë§‘ì€ ë§ˆìŒ", "ì‚¬ë‘ì˜ ì„±ê³µ"], tags: ["ê³ ë°±", "ì‘ì›", "ì‚¬ê³¼", "ë¶€íƒ"], caution: "íŠ¹ìœ ì˜ í–¥ì´ í˜¸ë¶ˆí˜¸ê°€ ê°ˆë¦´ ìˆ˜ ìˆì–´ìš”." },
        { name: "ë¦¬ì‹œì•ˆì…”ìŠ¤", colors: ["#cdb4db", "#ffafcc", "#ffffff"], hex: ["#cdb4db", "#ffafcc", "#ffffff"], meanings: ["ë³€ì¹˜ ì•ŠëŠ” ì‚¬ë‘", "ìš°ì•„í•¨"], tags: ["ê³ ë°±", "ê°ì‚¬", "ì‚¬ê³¼", "ì¬íšŒ"], caution: "ê½ƒìì´ ì–‡ì•„ ì‰½ê²Œ ìƒì²˜ ì…ì„ ìˆ˜ ìˆì–´ìš”." },
        { name: "í”„ë¦¬ì§€ì•„", colors: ["#ffea00"], hex: ["#ffea00"], meanings: ["ë‹¹ì‹ ì˜ ì‹œì‘ì„ ì‘ì›í•´", "ì²œì§„ë‚œë§Œ"], tags: ["ì‘ì›", "ì¶•í•˜", "ê¸°íƒ€"], caution: "í–¥ì´ ê°•í•´ ì‹ì‚¬ ìë¦¬ì—ëŠ” í”¼í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”." },
        { name: "í•´ë°”ë¼ê¸°", colors: ["#ffb700"], hex: ["#ffb700"], meanings: ["ê¸°ë‹¤ë¦¼", "ìˆ­ë°°", "ì¼í¸ë‹¨ì‹¬"], tags: ["ê³ ë°±", "ì‘ì›", "ì¬íšŒ"], caution: "ë¨¸ë¦¬ê°€ ë¬´ê±°ì›Œ ì¤„ê¸°ê°€ íœ  ìˆ˜ ìˆì–´ìš”." },
        { name: "ìˆ˜êµ­", colors: ["#a2d2ff", "#ffafcc", "#bde0fe"], hex: ["#a2d2ff", "#ffafcc", "#bde0fe"], meanings: ["ì§„ì‹¬", "ë³€ë•", "ëƒ‰ì •"], tags: ["ì‚¬ê³¼", "ê°ì‚¬", "ì´ë³„"], caution: "ë¬¼ì„ ì•„ì£¼ ë§ì´ ë¨¹ëŠ” ê½ƒì´ì—ìš”." },
        { name: "ì‘ì•½", colors: ["#ff8fa3", "#ff4d6d"], hex: ["#ff8fa3", "#ff4d6d"], meanings: ["ìˆ˜ì¤ìŒ", "ë¶€ê·€"], tags: ["ê³ ë°±", "ê°ì‚¬", "ì¶•í•˜"], caution: "ê°œí™” ì†ë„ê°€ ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤." },
        { name: "ë¼ë„Œí˜ëŸ¬ìŠ¤", colors: ["#ffccd5", "#ffb3c1", "#ff8fa3"], hex: ["#ffccd5", "#ffb3c1", "#ff8fa3"], meanings: ["ë§¤ë ¥", "ë§¤í˜¹"], tags: ["ê³ ë°±", "ì¶•í•˜"], caution: "ì¤„ê¸°ê°€ ì•½í•´ ì§€ì§€ëŒ€ê°€ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”." },
        { name: "ë°±í•©", colors: ["#ffffff"], hex: ["#ffffff"], meanings: ["ìˆœê²°", "ë³€í•¨ì—†ëŠ” ì‚¬ë‘"], tags: ["ì¡´ì¤‘", "ìœ„ë¡œ", "ì´ë³„"], caution: "í–¥ì´ ê°•í•˜ê³  ê½ƒê°€ë£¨ê°€ ì˜·ì— ë¬»ìœ¼ë©´ ì§€ìš°ê¸° í˜ë“¤ì–´ìš”." },
        { name: "ìŠ¤í†¡", colors: ["#f8ad9d", "#fbc4ab"], hex: ["#f8ad9d", "#fbc4ab"], meanings: ["ì˜ì›í•œ ì•„ë¦„ë‹¤ì›€", "ì—­ê²½ ì†ì˜ ë¯¿ìŒ"], tags: ["ê³ ë°±", "ì‘ì›", "ìœ„ë¡œ"], caution: "ì‹œë“  ê½ƒìì„ ë°”ë¡œ ì œê±°í•´ì¤˜ì•¼ í•´ìš”." },
        { name: "ë¸í”¼ëŠ„", colors: ["#4895ef", "#4cc9f0"], hex: ["#4895ef", "#4cc9f0"], meanings: ["ë‹¹ì‹ ì„ í–‰ë³µí•˜ê²Œ í•´ì¤„ê²Œìš”"], tags: ["ì‘ì›", "ê³ ë°±", "ì¶•í•˜"], caution: "ë…ì„±ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ë°˜ë ¤ë™ë¬¼ì„ ì£¼ì˜í•˜ì„¸ìš”." },
        { name: "ìœ ì¹¼ë¦½íˆ¬ìŠ¤", colors: ["#95d5b2", "#74c69d"], hex: ["#95d5b2", "#74c69d"], meanings: ["ì¹˜ìœ ", "ì¶”ì–µ"], tags: ["ìœ„ë¡œ", "ì‘ì›", "ì´ë³„"], caution: "ë§ëì„ ë•Œ ë¶€ìŠ¤ëŸ¬ì§€ê¸° ì‰½ìŠµë‹ˆë‹¤." }
    ];

    const COLOR_MAP = {
        "ì‚¬ê³¼": ["#ffffff", "#cdb4db", "#a2d2ff"], // í™”ì´íŠ¸, ì—°ë³´ë¼, ì—°ë¸”ë£¨
        "ê°ì‚¬": ["#ffafcc", "#ffccd5", "#ffc8dd"], // í•‘í¬, ì—°í•‘í¬
        "ì¶•í•˜": ["#ffea00", "#ff9770", "#ff70a6"], // ì˜ë¡œìš°, ì˜¤ë Œì§€
        "ìœ„ë¡œ": ["#95d5b2", "#ffffff", "#bde0fe"], // ê·¸ë¦°, í™”ì´íŠ¸, ìŠ¤ì¹´ì´
        "ê³ ë°±": ["#e63946", "#ff4d6d", "#ff8fa3"], // ë ˆë“œ, ì§„í•‘í¬
        "ì‘ì›": ["#ffb700", "#4cc9f0", "#ffea00"], // ì˜ë¡œìš°, ë¸”ë£¨
        "ì´ë³„": ["#ffffff", "#95d5b2", "#cdb4db"], // í™”ì´íŠ¸, ê·¸ë¦°, ë³´ë¼
        "ì¬íšŒ": ["#ffb3c1", "#cdb4db", "#ffffff"], // í•‘í¬, ë³´ë¼, í™”ì´íŠ¸
        "ë¶€íƒ": ["#ffffff", "#ffafcc", "#bde0fe"], // í™”ì´íŠ¸, í•‘í¬, ì—°ë¸”ë£¨
    };

    const generateBtn = document.getElementById('generate-btn');
    const resetBtn = document.getElementById('reset-btn');
    const inputSection = document.getElementById('input-section');
    const resultSection = document.getElementById('result-section');

    generateBtn.addEventListener('click', () => {
        const draft = document.getElementById('draft').value;
        if (!draft.trim()) {
            alert("í¸ì§€ ì´ˆì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        const data = {
            recipient: document.getElementById('recipient').value,
            purpose: document.getElementById('purpose').value,
            emotions: Array.from(document.querySelectorAll('input[name="emotion"]:checked')).map(el => el.value),
            tone: document.querySelector('input[name="tone"]:checked').value,
            length: document.querySelector('input[name="length"]:checked').value,
            mustInclude: document.getElementById('must-include').value,
            avoid: document.getElementById('avoid-express').value,
            draft: draft
        };

        const flowerSets = recommendFlowers(data);
        const letterVersions = rewriteLetter(data, flowerSets[0]);
        const shortPhrases = generateShortPhrases(data, flowerSets[0]);

        renderResults(flowerSets, letterVersions, shortPhrases);

        inputSection.style.display = 'none';
        resultSection.style.display = 'block';
        window.scrollTo(0, 0);
    });

    resetBtn.addEventListener('click', () => {
        document.getElementById('draft').value = '';
        document.getElementById('must-include').value = '';
        document.getElementById('avoid-express').value = '';
        document.querySelectorAll('input[name="emotion"]').forEach(el => el.checked = false);
        inputSection.style.display = 'block';
        resultSection.style.display = 'none';
    });

    function recommendFlowers(data) {
        // Simple scoring logic
        const scoredFlowers = FLOWER_DATA.map(flower => {
            let score = 0;
            // Match by tags
            if (flower.tags.includes(data.purpose)) score += 5;
            data.emotions.forEach(emo => {
                if (flower.tags.includes(emo)) score += 2;
            });
            // Relationship specific
            if (data.recipient === "ê°€ì¡±" && flower.name === "ì¹´ë„¤ì´ì…˜") score += 3;
            if (data.recipient === "ì—°ì¸" && ["ì¥ë¯¸", "íŠ¤ë¦½", "ì‘ì•½", "ë¼ë„Œí˜ëŸ¬ìŠ¤"].includes(flower.name)) score += 2;
            
            return { ...flower, score: score + Math.random() }; // Randomness for variety
        });

        scoredFlowers.sort((a, b) => b.score - a.score);

        // Create 3 sets
        const sets = [
            {
                name: `${data.purpose}ì˜ ì§„ì‹¬ì„ ë‹´ì€ ì¡°í•©`,
                palette: COLOR_MAP[data.purpose] || ["#ffb3c1", "#ffccd5", "#ffffff"],
                flowers: scoredFlowers.slice(0, 4),
                reasoning: `${data.recipient}ë‹˜ê»˜ ${data.purpose}í•˜ëŠ” ë§ˆìŒì„ ë‹´ì•„, ${scoredFlowers[0].meanings[0]}ê³¼ ${scoredFlowers[1].meanings[0]}ì˜ ì˜ë¯¸ë¥¼ ê²°í•©í–ˆìŠµë‹ˆë‹¤.`,
                caution: scoredFlowers[0].caution
            },
            {
                name: `ë”°ëœ»í•œ ${data.emotions[0] || 'ì§„ì‹¬'}ì˜ ì¡°í™”`,
                palette: [scoredFlowers[2].hex[0], scoredFlowers[3].hex[0], "#ffffff"],
                flowers: [scoredFlowers[2], scoredFlowers[3], scoredFlowers[4], scoredFlowers[5]].filter(Boolean),
                reasoning: `ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šìœ¼ë©´ì„œë„ ê¹Šì€ ë°°ë ¤ê°€ ëŠê»´ì§€ëŠ” ì¡°í•©ì…ë‹ˆë‹¤. ${scoredFlowers[2].name}ì˜ ${scoredFlowers[2].meanings[0]} ê½ƒë§ì´ í¬ì¸íŠ¸ì…ë‹ˆë‹¤.`,
                caution: scoredFlowers[2].caution
            },
            {
                name: `ìš°ì•„í•˜ê³  ê²©ì‹ ìˆëŠ” ì„ íƒ`,
                palette: ["#ffffff", "#cdb4db", "#95d5b2"],
                flowers: scoredFlowers.slice(4, 8).filter(Boolean).length > 0 ? scoredFlowers.slice(4, 8) : scoredFlowers.slice(1, 4),
                reasoning: `ì°¨ë¶„í•œ í†¤ìœ¼ë¡œ ì§„ì¤‘í•¨ì„ ë”í–ˆìŠµë‹ˆë‹¤. ${data.recipient}ë‹˜ê³¼ì˜ ê´€ê³„ì— ì‹ ë¢°ë¥¼ ë”í•´ì¤„ ê²ƒì…ë‹ˆë‹¤.`,
                caution: "ê½ƒì˜ í–¥ì´ ì„ì´ì§€ ì•Šë„ë¡ ì‹ ì„ í•œ ìƒíƒœë¥¼ ìœ ì§€í•´ì£¼ì„¸ìš”."
            }
        ];

        return sets;
    }

    function rewriteLetter(data, bestFlowerSet) {
        const flowerNames = bestFlowerSet.flowers.slice(0, 2).map(f => f.name).join(', ');
        const mainMeaning = bestFlowerSet.flowers[0].meanings[0];
        
        let baseContent = data.draft;
        if (data.mustInclude) baseContent += ` ${data.mustInclude}`;
        if (data.avoid) {
            const avoidWords = data.avoid.split(',').map(s => s.trim());
            avoidWords.forEach(word => {
                baseContent = baseContent.split(word).join('');
            });
        }

        const versions = [
            {
                type: "ì§§ê³  ëª…í™•í•˜ê²Œ (Short)",
                content: `ì•ˆë…•í•˜ì„¸ìš”, ${data.recipient}ë‹˜.\n${baseContent}\n\nì˜¤ëŠ˜ ${flowerNames}ì˜ ${mainMeaning}ì„ ë¹Œë ¤ ì œ ë§ˆìŒì„ ì „í•©ë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.`
            },
            {
                type: "ë‹¤ì •í•˜ê³  ê¸°ë³¸ì ì´ê²Œ (Basic)",
                content: `${data.recipient}ë‹˜ê»˜,\n\n${baseContent}\n\nì§ì ‘ ë§ë¡œ ë‹¤ í•˜ê¸° ì‘¥ìŠ¤ëŸ¬ì›Œ ì´ í¸ì§€ì™€ í•¨ê»˜ ${flowerNames}ë¥¼ ê³¨ë¼ë´¤ì–´ìš”. ê½ƒë§ì²˜ëŸ¼ ${mainMeaning}í•˜ëŠ” ì œ ë§ˆìŒì´ ì˜ ì „ë‹¬ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n\nì–¸ì œë‚˜ ì‘ì›í•©ë‹ˆë‹¤.`
            },
            {
                type: "ë¬¸í•™ì ì´ê³  ê¹Šì´ìˆê²Œ (Literary)",
                content: `ì¹œì• í•˜ëŠ” ${data.recipient}ë‹˜ê»˜,\n\nê³„ì ˆì˜ í‹ˆ ì‚¬ì´ë¡œ ${bestFlowerSet.flowers[0].name}ì˜ í–¥ê¸°ê°€ ìŠ¤ë©°ë“œëŠ” ë‚ ì…ë‹ˆë‹¤.\n${baseContent}\n\në§ˆì¹˜ ${mainMeaning}ì´ë¼ëŠ” ê½ƒë§ì²˜ëŸ¼, ì œ ì§„ì‹¬ë„ ë‹¹ì‹ ì˜ ê³ì— ì€ì€í•˜ê²Œ ë¨¸ë¬¼ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ì´ ì‘ì€ ê½ƒë‹¤ë°œì´ ë‹¹ì‹ ì˜ í•˜ë£¨ì— ì‘ì€ ë¹›ì´ ë˜ê¸¸ ë¹Œë©°.\n\në‹¹ì‹ ì˜ í‰ì•ˆì„ ë¹•ë‹ˆë‹¤.`
            }
        ];

        return versions;
    }

    function generateShortPhrases(data, bestFlowerSet) {
        return [
            `"${bestFlowerSet.flowers[0].name}ì²˜ëŸ¼ ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ í”¼ì–´ë‚˜ê¸¸."`,
            `"${bestFlowerSet.flowers[0].meanings[0]}ì˜ ì§„ì‹¬ì„ ë‹´ì•„ ë³´ëƒ…ë‹ˆë‹¤."`
        ];
    }

    function renderResults(flowerSets, letterVersions, shortPhrases) {
        const flowerContainer = document.getElementById('flower-results');
        flowerContainer.innerHTML = '';
        flowerSets.forEach(set => {
            const card = document.createElement('div');
            card.className = 'flower-card';
            card.innerHTML = `
                <h3>${set.name}</h3>
                <div class="palette">
                    ${set.palette.map(c => `<div class="color-circle" style="background-color: ${c}"></div>`).join('')}
                </div>
                <div class="flower-list">
                    ${set.flowers.map(f => `<div class="flower-item"><strong>${f.name}</strong>: ${f.meanings.join(', ')}</div>`).join('')}
                </div>
                <div class="flower-reasoning">${set.reasoning}</div>
                <div class="caution">âš ï¸ ${set.caution}</div>
            `;
            flowerContainer.appendChild(card);
        });

        const letterContainer = document.getElementById('letter-results');
        letterContainer.innerHTML = '';
        letterVersions.forEach(v => {
            const card = document.createElement('div');
            card.className = 'letter-card';
            card.innerHTML = `
                <div class="letter-header">
                    <span class="letter-type">${v.type}</span>
                    <button class="copy-btn" onclick="copyToClipboard(this)">ë³µì‚¬í•˜ê¸°</button>
                </div>
                <div class="letter-body">${v.content}</div>
            `;
            letterContainer.appendChild(card);
        });

        const phraseContainer = document.getElementById('phrase-results');
        phraseContainer.innerHTML = '';
        shortPhrases.forEach(p => {
            const div = document.createElement('div');
            div.className = 'short-phrase';
            div.innerText = p;
            phraseContainer.appendChild(div);
        });
    }

    window.copyToClipboard = function(btn) {
        const text = btn.parentElement.nextElementSibling.innerText;
        navigator.clipboard.writeText(text).then(() => {
            const originalText = btn.innerText;
            btn.innerText = "ë³µì‚¬ë¨!";
            setTimeout(() => btn.innerText = originalText, 2000);
        });
    }
</script>

</body>
</html>
